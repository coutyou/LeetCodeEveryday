# 227. 基本计算器 II

## 题目

实现一个基本的计算器来计算一个简单的字符串表达式的值。

字符串表达式仅包含非负整数，`+`， `-` ，`*`，`/` 四种运算符和空格 ` `。 整数除法仅保留整数部分。

## 示例

**示例 1：**

> 输入: "3+2*2"
> 输出: 7

**示例 2：**

> 输入: " 3/2 "
> 输出: 1

**示例 3：**

> 输入: " 3+5 / 2 "
> 输出: 5

## 提示

* 你可以假设所给定的表达式都是有效的。
* 请不要使用内置的库函数` eval `。

## 解题思路

如果只有加减法，那么很简单，用栈操作就行了，但是本题还有乘除法，其优先级比加减法高。那么可以考虑分为两步进行运算，先进行乘除法，再进行加减法。

为此，用一个栈储存乘除法的结果，最后求和。遍历字符串，并且记录上一个操作符，遇到操作符则意味num的累积结束了，对上一个操作符进行判断，如果是加减，则将num或-num入栈。如果是乘除法，则将栈顶的元素与num进行乘除法运算再入栈。遍历结束后，虽然没有操作符了，但还是要对上一个操作符进行判断。最后进行栈内元素的求和。

但是其实还可以进一步优化空间，仔细想一下，为什么要用栈，因为遇到乘除法时，需要弹出栈顶元素，而且有连续进行乘除法的情况，但是当这一段乘除法结束后，这部分的结果就再也不需要弹出栈了，因此，可以考虑在连续的乘除法结束后，直接加到结果，不再需要维护一个栈，而改用一个变量tmp维护暂时没有结束的连续乘除法的结果，并用一个变量res记录此前已经结束连续乘除法的和。而如何判断连续乘除法是否结束，因为我们是在碰到操作符后进行运算的，并且维护上一个操作符，针对的是上一个操作符做不同的操作，所以如果当前碰到的操作符不是乘除法就说明连续的乘除法结束了，可以将tmp加入res中。

时间复杂度为O(n)，空间复杂度为O(1)。

## 性能

执行用时：76 ms, 在所有 Python3 提交中击败了95.61%的用户

内存消耗：15 MB, 在所有 Python3 提交中击败了98.76%的用户

## 声明

来源：力扣（LeetCode）
链接：https://leetcode-cn.com/problems/basic-calculator-ii/
著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。